<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ancient Egypt: New Kingdom Complete</title>
    <!-- Fonts: Fredoka for headings (friendly/rounded), Open Sans for body (readable) -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Open+Sans:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <!-- jsPDF Library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            /* Palette: Sensory-friendly Pastels */
            --bg-sand: #fdf6e3;
            --card-bg: #ffffff;
            --text-dark: #2c3e50;
            --text-light: #5d6d7e;
            
            /* Playful but calm accents */
            --accent-gold: #f9e79f; 
            --accent-gold-dark: #f1c40f;
            --accent-teal: #a2d9ce;
            --accent-teal-dark: #16a085;
            --accent-coral: #f1948a;
            --accent-coral-dark: #e74c3c;
            --accent-blue: #aed6f1;
            --accent-blue-dark: #2980b9;
            --accent-purple: #d7bde2;
            --accent-purple-dark: #884ea0;
            
            --radius: 12px;
            --shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background-color: var(--bg-sand);
            color: var(--text-dark);
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Main Container */
        #app-container {
            background: var(--card-bg);
            width: 100%;
            max-width: 600px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
            border: 3px solid var(--accent-gold);
        }

        /* Header & Progress */
        header {
            background: var(--accent-teal);
            padding: 15px;
            text-align: center;
            color: #fff;
            border-bottom: 2px solid var(--accent-teal-dark);
        }

        h1 {
            font-family: 'Fredoka', sans-serif;
            margin: 0;
            font-size: 1.3rem;
            color: #2c3e50; 
        }

        #progress-bar-container {
            background: rgba(255,255,255,0.5);
            height: 8px;
            border-radius: 4px;
            margin-top: 10px;
            overflow: hidden;
        }

        #progress-bar {
            background: var(--accent-gold-dark);
            height: 100%;
            width: 0%;
            transition: width 0.5s ease-out;
        }

        /* Content Area */
        main {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .slide {
            display: none;
            animation: slideIn 0.4s ease-out;
        }

        .slide.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        h2 {
            font-family: 'Fredoka', sans-serif;
            color: var(--accent-teal-dark);
            font-size: 1.4rem;
            margin-top: 0;
            margin-bottom: 15px;
            border-bottom: 2px dashed var(--bg-sand);
            padding-bottom: 5px;
        }

        p {
            margin-bottom: 12px;
            font-size: 1.05rem;
        }

        /* List Styling */
        ul, ol {
            padding-left: 0;
            margin: 10px 0;
        }

        li {
            list-style: none;
            background: #f8f9f9;
            margin-bottom: 8px;
            padding: 10px 15px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-blue);
            font-size: 1rem;
        }

        /* Visual Hints & Placeholders */
        .hint-box {
            background-color: #fff9c4; /* Light yellow */
            border: 2px solid var(--accent-gold-dark);
            border-radius: 8px;
            padding: 12px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .hint-icon {
            font-size: 1.5rem;
        }

        /* Map/Image Styles with Expand Feature */
        .img-placeholder {
            width: 100%;
            background-color: #e3f2fd;
            border: 2px dashed var(--accent-blue-dark);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            padding: 10px; 
            box-sizing: border-box;
            position: relative;
        }

        .img-placeholder img {
            width: 100%;
            max-height: 250px;
            object-fit: contain;
            cursor: pointer;
            transition: transform 0.2s ease;
            border-radius: 4px;
        }

        .img-placeholder img:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .click-hint {
            font-size: 0.9rem;
            color: var(--accent-blue-dark);
            margin-top: 8px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            animation: fadeIn 0.3s;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            max-width: 95%;
            max-height: 85vh;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background: white;
            padding: 5px;
        }

        .close-modal-btn {
            margin-top: 15px;
            background: var(--accent-coral-dark);
            color: white;
            padding: 10px 25px;
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            font-family: 'Fredoka', sans-serif;
            font-weight: bold;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Interactive Buttons */
        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        button {
            font-family: 'Fredoka', sans-serif;
            border: none;
            padding: 10px 20px;
            border-radius: 30px; 
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        button:active {
            transform: scale(0.98);
        }

        .btn-next {
            background-color: var(--accent-teal-dark);
            color: white;
            margin-left: auto; 
        }

        .btn-back {
            background-color: #ecf0f1;
            color: var(--text-light);
        }

        .btn-pdf {
            background-color: var(--accent-coral-dark);
            color: white;
            width: 100%;
            margin-top: 15px;
            font-size: 1.1rem;
            padding: 15px;
        }

        /* Quiz Styles */
        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            background: white;
            border: 2px solid #eee;
            margin-bottom: 8px;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.2s;
        }

        .option-btn:hover {
            border-color: var(--accent-blue);
            background: #f4f6f7;
        }

        .option-btn.selected {
            background: var(--accent-blue);
            border-color: var(--accent-blue-dark);
            color: #000;
        }

        .feedback-msg {
            font-weight: bold;
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            display: none;
        }

        .correct { background-color: #d5f5e3; color: #196f3d; }
        .incorrect { background-color: #fadbd8; color: #943126; }

        strong {
            color: var(--accent-coral-dark);
        }

        em {
            color: var(--text-light);
        }
    </style>
</head>
<body>

<div id="app-container">
    <header>
        <h1>New Kingdom Complete</h1>
        <div id="progress-bar-container">
            <div id="progress-bar"></div>
        </div>
    </header>

    <main>
        <!-- Slide 1: Welcome -->
        <div class="slide active" id="slide-1">
            <h2>Welcome, Gabriel!</h2>
            <p>Today we will explore the full story of the <strong>New Kingdom</strong>.</p>
            <ol>
                <li><strong>The Beginning:</strong> Ahmose & The Hyksos.</li>
                <li><strong>The Golden Age:</strong> Hatshepsut, Thutmose III, & Kush.</li>
                <li><strong>The Big Change:</strong> Akhenaten & Nefertiti (One God).</li>
                <li><strong>The Restoration:</strong> King Tut & Ramses II.</li>
                <li><strong>The End:</strong> Ramses III & The Collapse.</li>
            </ol>
            <div class="hint-box">
                <span class="hint-icon">üí°</span>
                <span><strong>Tip:</strong> Pay attention to how the religion changed and then changed back.</span>
            </div>
            <div class="btn-container">
                <button class="btn-next" onclick="nextSlide()">Start Part 1</button>
            </div>
        </div>

        <!-- Slide 2: The Hyksos -->
        <div class="slide" id="slide-2">
            <h2>1. The Beginning</h2>
            <p>Before the Golden Age, Egypt was weak. Invaders called the <strong>Hyksos</strong> took over the North.</p>
            <ul>
                <li>They had <strong>chariots</strong> (carts pulled by horses).</li>
                <li>They had strong metal weapons.</li>
            </ul>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">The Map</button>
            </div>
        </div>

        <!-- Slide 3: Map Visual -->
        <div class="slide" id="slide-3">
            <h2>The Divided Land</h2>
            <p>Egypt was cut in half!</p>
            
            <!-- Map Placeholder with CLICK Action -->
            <div class="img-placeholder">
                <img src="https://static.wixstatic.com/media/b2863d_6d1e1c8884b545ac87bbf590f27be9dd~mv2.jpg" alt="Map of Ancient Egypt" onclick="openModal(this.src)">
                <div class="click-hint" onclick="openModal(document.querySelector('#slide-3 img').src)">
                    <span>üîç</span> Click map to make it BIGGER
                </div>
            </div>

            <p style="text-align:center; margin-top: -10px;">
                <span style="color:var(--accent-coral-dark);">North (Hyksos)</span> 
                vs 
                <span style="color:var(--accent-teal-dark);">South (Egyptians)</span>
            </p>

            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Ahmose Wins</button>
            </div>
        </div>

        <!-- Slide 4: Ahmose Wins -->
        <div class="slide" id="slide-4">
            <h2>Ahmose Fights Back</h2>
            <p><strong>Pharaoh Ahmose</strong> was smart. He copied the Hyksos and built his own chariots.</p>
            <ul>
                <li>He chased the Hyksos out of Egypt.</li>
                <li>He united the country again.</li>
                <li>This started the <strong>New Kingdom</strong> (The Empire Age).</li>
            </ul>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Hatshepsut</button>
            </div>
        </div>

        <!-- Slide 5: Hatshepsut -->
        <div class="slide" id="slide-5">
            <h2>2. Hatshepsut: The Trader</h2>
            <p>Hatshepsut was a rare female Pharaoh. She wore a <strong>false beard</strong> to look powerful.</p>
            <p>She didn't like war. She liked <strong>Trade</strong>.</p>
            <ul>
                <li>She sent ships to the land of <strong>Punt</strong>.</li>
                <li>She brought back gold, ivory, and incense trees.</li>
            </ul>
            <div class="hint-box">
                <span class="hint-icon">‚öñÔ∏è</span>
                <span><strong>Trade</strong> = Buying and selling things with neighbors.</span>
            </div>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Thutmose III</button>
            </div>
        </div>

        <!-- Slide 6: Thutmose III -->
        <div class="slide" id="slide-6">
            <h2>3. Thutmose III: The Warrior</h2>
            <p>After Hatshepsut, her stepson <strong>Thutmose III</strong> became King.</p>
            <p>He was very different. He was a great general.</p>
            <ul>
                <li>He fought many battles to expand Egypt's borders.</li>
                <li>He conquered the <strong>Kingdom of Kush</strong> in the South.</li>
                <li>He made the Egyptian Empire huge!</li>
            </ul>
            <div class="hint-box">
                <span class="hint-icon">‚öîÔ∏è</span>
                <span>Hatshepsut used <strong>Trade</strong>. Thutmose used <strong>Might</strong>.</span>
            </div>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">The Kingdom of Kush</button>
            </div>
        </div>
        
        <!-- Slide 7: The Kingdom of Kush -->
        <div class="slide" id="slide-7">
            <h2>The Kingdom of Kush</h2>
            <p>To the south of Egypt lived the people of <strong>Kush</strong> (also called Nubia).</p>
            <p>They were a powerful kingdom with their own culture.</p>
            <ul>
                <li><strong>Gold Mines:</strong> Their land was full of gold. Egypt wanted this gold for their temples.</li>
                <li><strong>Archers:</strong> The people of Kush were famous for being amazing with a bow and arrow.</li>
            </ul>
            <div class="hint-box">
                <span class="hint-icon">üèπ</span>
                <span>Egypt called Kush the <strong>"Land of the Bow"</strong>.</span>
            </div>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Akhenaten & Nefertiti</button>
            </div>
        </div>

        <!-- Slide 8: Akhenaten & Nefertiti (UPDATED) -->
        <div class="slide" id="slide-8">
            <h2>4. Akhenaten & Nefertiti</h2>
            <p>Later, Pharaoh <strong>Akhenaten</strong> and Queen <strong>Nefertiti</strong> changed everything. Nefertiti was very powerful, almost like a Pharaoh herself.</p>
            <ul>
                <li><strong>One God:</strong> Akhenaten said everyone must stop worshipping the old gods. He only worshipped <strong>Aten</strong> (the Sun Disk).</li>
                <li><strong>Closed Temples:</strong> He locked the doors of the temples for Amun and other gods. The priests were furious!</li>
                <li><strong>New Art:</strong> He changed how people were drawn. In art, they had long heads, bellies, and skinny arms.</li>
            </ul>
            <div class="hint-box">
                <span class="hint-icon">‚òÄÔ∏è</span>
                <span>This was a huge shock to Egypt. People missed their old traditions.</span>
            </div>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">King Tut</button>
            </div>
        </div>

        <!-- Slide 9: King Tut (UPDATED) -->
        <div class="slide" id="slide-9">
            <h2>5. King Tut: The Return to Normal</h2>
            <p>When Akhenaten died, his religion collapsed because the people hated it. His son, <strong>Tutankhamun</strong>, became King at age 9.</p>
            <ul>
                <li>He opened the old temples again.</li>
                <li>He brought back the old gods (like Amun).</li>
            </ul>

            <div class="img-placeholder">
                <img src="https://static.wixstatic.com/media/b2863d_c8325d6c3c7c44398377e7d2bebe3b88~mv2.jpg" alt="Howard Carter discovering King Tut's Tomb" onclick="openModal(this.src)">
                <div class="click-hint" onclick="openModal(document.querySelector('#slide-9 img').src)">
                    <span>üîç</span> Click to see the Tomb Discovery
                </div>
            </div>

            <p>Tut is famous today because in 1922, <strong>Howard Carter</strong> found his tomb <strong>untouched</strong> and full of gold!</p>
            
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Ramses II</button>
            </div>
        </div>

        <!-- Slide 10: Ramses II -->
        <div class="slide" id="slide-10">
            <h2>6. Ramses the Great</h2>
            <p><strong>Ramses II</strong> ruled for over 60 years! He was a powerful builder.</p>
            
            <div class="img-placeholder">
                <img src="https://static.wixstatic.com/media/b2863d_c676c03a575042a7acb24510e751abae~mv2.jpg" alt="Huge statues of Ramses II" onclick="openModal(this.src)">
                <div class="click-hint" onclick="openModal(document.querySelector('#slide-10 img').src)">
                    <span>üîç</span> Click to see the Giant Statues
                </div>
            </div>

            <p>He also signed the world's first <strong>Peace Treaty</strong> with the Hittites.</p>
            
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Ramses III</button>
            </div>
        </div>

        <!-- Slide 11: Ramses III -->
        <div class="slide" id="slide-11">
            <h2>7. Ramses III: The Defender</h2>
            <p><strong>Ramses III</strong> was the last "Great" Pharaoh. He had to defend Egypt from a big danger.</p>
            <ul>
                <li>He fought the <strong>"Sea Peoples"</strong> (pirates from the ocean).</li>
                <li>He won the battles, but the wars made Egypt lose money.</li>
            </ul>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">The Collapse</button>
            </div>
        </div>

        <!-- Slide 12: The Collapse -->
        <div class="slide" id="slide-12">
            <h2>8. The End of the New Kingdom</h2>
            <p>After Ramses III, things fell apart. This is called the <strong>Collapse</strong>.</p>
            <p><strong>Why did the Golden Age end?</strong></p>
            <ul>
                <li><strong>Weak Kings:</strong> The Pharaohs after Ramses III were not strong.</li>
                <li><strong>Powerful Priests:</strong> The priests of Amun took control of the South.</li>
                <li><strong>No Money:</strong> Wars cost too much gold.</li>
                <li><strong>Tomb Robbers:</strong> People started stealing from the tombs because they were poor.</li>
            </ul>
            <div class="hint-box">
                <span class="hint-icon">üìâ</span>
                <span>Egypt split into two parts again, ending the New Kingdom.</span>
            </div>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Summary</button>
            </div>
        </div>

        <!-- Slide 13: Summary -->
        <div class="slide" id="slide-13">
            <h2>Let's Remember</h2>
            <ul>
                <li><strong>Ahmose:</strong> Kicked out Hyksos.</li>
                <li><strong>Hatshepsut:</strong> Trade & Peace.</li>
                <li><strong>Thutmose III:</strong> War & Kush (Gold).</li>
                <li><strong>Akhenaten:</strong> Closed temples, One God (Aten), Strange Art.</li>
                <li><strong>King Tut:</strong> Restored old gods & Golden Tomb.</li>
                <li><strong>Ramses II:</strong> Giant Statues & Peace Treaty.</li>
                <li><strong>Ramses III:</strong> Defended against Sea Peoples.</li>
                <li><strong>Collapse:</strong> Weak kings and robbers ended the era.</li>
            </ul>
            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Back</button>
                <button class="btn-next" onclick="nextSlide()">Final Quiz</button>
            </div>
        </div>

        <!-- Slide 14: Quiz -->
        <div class="slide" id="slide-14">
            <h2>Final Quiz</h2>
            <p>Match the Pharaoh or Event!</p>

            <!-- Q1 -->
            <div style="margin-bottom: 20px;">
                <p><strong>1. What did Akhenaten change?</strong></p>
                <button class="option-btn" onclick="checkAnswer(this, 'correct', 'q1-fb')">He closed temples and worshipped only one god (Aten).</button>
                <button class="option-btn" onclick="checkAnswer(this, 'wrong', 'q1-fb')">He built the Great Sphinx.</button>
                <div id="q1-fb" class="feedback-msg"></div>
            </div>

            <!-- Q2 -->
            <div style="margin-bottom: 20px;">
                <p><strong>2. What was the Kingdom of Kush famous for?</strong></p>
                <button class="option-btn" onclick="checkAnswer(this, 'wrong', 'q2-fb')">Ice.</button>
                <button class="option-btn" onclick="checkAnswer(this, 'correct', 'q2-fb')">Gold Mines and Archers.</button>
                <div id="q2-fb" class="feedback-msg"></div>
            </div>

            <!-- Q3 -->
            <div style="margin-bottom: 20px;">
                <p><strong>3. Who signed the first Peace Treaty?</strong></p>
                <button class="option-btn" onclick="checkAnswer(this, 'correct', 'q3-fb')">Ramses II (The Great)</button>
                <button class="option-btn" onclick="checkAnswer(this, 'wrong', 'q3-fb')">King Tut</button>
                <div id="q3-fb" class="feedback-msg"></div>
            </div>

            <!-- Q4 -->
            <div style="margin-bottom: 20px;">
                <p><strong>4. Who invaded Egypt at the end (fought Ramses III)?</strong></p>
                <button class="option-btn" onclick="checkAnswer(this, 'correct', 'q4-fb')">The Sea Peoples</button>
                <button class="option-btn" onclick="checkAnswer(this, 'wrong', 'q4-fb')">The Romans</button>
                <div id="q4-fb" class="feedback-msg"></div>
            </div>

            <!-- Q5 -->
            <div style="margin-bottom: 20px;">
                <p><strong>5. Why did Akhenaten's religion collapse?</strong></p>
                <button class="option-btn" onclick="checkAnswer(this, 'wrong', 'q5-fb')">Because everyone loved it.</button>
                <button class="option-btn" onclick="checkAnswer(this, 'correct', 'q5-fb')">People missed their old traditions and King Tut restored the old gods.</button>
                <div id="q5-fb" class="feedback-msg"></div>
            </div>

            <div class="btn-container">
                <button class="btn-back" onclick="prevSlide()">Review</button>
                <button class="btn-next" onclick="nextSlide()">Finish</button>
            </div>
        </div>

        <!-- Slide 15: Finish -->
        <div class="slide" id="slide-15">
            <h2>Excellent Work, Gabriel!</h2>
            <p>You have finished the entire story of the New Kingdom!</p>
            <p>Click the button below to save your official report.</p>
            
            <button class="btn-pdf" onclick="generatePDF()">
                Download My Full History Report
            </button>
        </div>

    </main>
</div>

<!-- Modal Structure for Images -->
<div id="img-modal" class="modal-overlay" onclick="closeModal()">
    <img id="modal-img-tag" src="" class="modal-content" alt="Expanded Image">
    <button class="close-modal-btn">Close Image</button>
</div>

<script>
    // --- State Management ---
    let currentSlide = 1;
    const totalSlides = 15; // Increased slide count
    
    // Tracks quiz answers for the PDF 
    let quizResults = {
        q1: 0,
        q2: 0,
        q3: 0,
        q4: 0,
        q5: 0
    };

    // --- Navigation ---
    function showSlide(n) {
        const slides = document.querySelectorAll('.slide');
        slides.forEach(s => s.classList.remove('active'));
        document.getElementById(`slide-${n}`).classList.add('active');
        
        const percent = ((n - 1) / (totalSlides - 1)) * 100;
        document.getElementById('progress-bar').style.width = `${percent}%`;
        
        currentSlide = n;
    }

    function nextSlide() {
        if (currentSlide < totalSlides) {
            showSlide(currentSlide + 1);
        }
    }

    function prevSlide() {
        if (currentSlide > 1) {
            showSlide(currentSlide - 1);
        }
    }

    // --- Modal Functions ---
    function openModal(imgSrc) {
        document.getElementById('modal-img-tag').src = imgSrc;
        document.getElementById('img-modal').classList.add('active');
    }

    function closeModal() {
        document.getElementById('img-modal').classList.remove('active');
    }

    // --- Quiz Logic ---
    function checkAnswer(btn, status, feedbackId) {
        const parent = btn.parentElement;
        const buttons = parent.querySelectorAll('.option-btn');
        const feedback = document.getElementById(feedbackId);

        buttons.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');

        const qKey = feedbackId.split('-')[0]; // "q1", "q2", etc.

        if (status === 'correct') {
            feedback.innerText = "Correct! You got it.";
            feedback.className = "feedback-msg correct";
            feedback.style.display = "block";
            quizResults[qKey] = 1;
        } else {
            feedback.innerText = "Try again.";
            feedback.className = "feedback-msg incorrect";
            feedback.style.display = "block";
            quizResults[qKey] = 2;
        }
    }

    // --- PDF Generation ---
    function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Settings
        const margin = 20;
        const pageWidth = 210;
        const contentWidth = pageWidth - (margin * 2);
        let y = 20;
        const date = new Date().toLocaleDateString();

        // Helper to add text and advance Y position
        function addLine(text, fontSize = 12, isBold = false) {
            doc.setFont("helvetica", isBold ? "bold" : "normal");
            doc.setFontSize(fontSize);
            
            // Text wrapping check
            const splitText = doc.splitTextToSize(text, contentWidth);
            
            // Page break check
            if (y + (splitText.length * 7) > 280) {
                doc.addPage();
                y = 20;
            }

            doc.text(splitText, margin, y);
            y += (splitText.length * 7) + 2; 
        }

        // Header
        addLine("Student: Gabriel Mendoza", 16, true);
        addLine(`Date: ${date}`, 12);
        addLine("Subject: Ancient Egypt - New Kingdom Complete", 12);
        
        y += 5;
        doc.setDrawColor(150);
        doc.line(margin, y, pageWidth - margin, y);
        y += 10;

        // Content Summary
        addLine("Summary of Learning:", 14, true);
        y += 2;
        addLine("1. Ahmose defeated the Hyksos invaders to start the New Kingdom.");
        addLine("2. Hatshepsut (Trade) & Thutmose III (War & Kush).");
        addLine("3. Akhenaten & Nefertiti closed temples and worshipped One God (Aten).");
        addLine("4. They changed the art style to show people with long heads.");
        addLine("5. King Tut restored the old gods; his tomb was found untouched.");
        addLine("6. Ramses II built giant statues and made peace treaties.");
        addLine("7. Ramses III defended Egypt from the Sea Peoples.");
        addLine("8. The New Kingdom collapsed due to weak kings and robbers.");

        y += 10;
        
        // Quiz Report
        addLine("Quiz Performance:", 14, true);
        y += 2;

        const results = [
            { id: 'q1', text: "Q1: Akhenaten (One God & Closed Temples)" },
            { id: 'q2', text: "Q2: Kingdom of Kush (Gold)" },
            { id: 'q3', text: "Q3: Ramses II (Peace Treaty)" },
            { id: 'q4', text: "Q4: Sea Peoples (Invaders)" },
            { id: 'q5', text: "Q5: Why Atenism Collapsed (People hated it)" }
        ];

        let score = 0;

        results.forEach(item => {
            const statusVal = quizResults[item.id];
            let statusText = "Not Answered";
            if (statusVal === 1) { statusText = "Correct"; score++; }
            if (statusVal === 2) statusText = "Incorrect";
            
            addLine(`${item.text}: ${statusText}`);
        });

        y += 5;
        addLine(`Final Score: ${score} / 5`, 12, true);

        // Save
        doc.save("Gabriel_NewKingdom_Complete.pdf");
    }

    // Initialize
    showSlide(1);

</script>

</body>
</html>
